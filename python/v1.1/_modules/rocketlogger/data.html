

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>rocketlogger.data &mdash; &#39;RocketLogger Python Support&#39; 1.1a1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="&#39;RocketLogger Python Support&#39; 1.1a1 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> 'RocketLogger Python Support'
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">rocketlogger</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">'RocketLogger Python Support'</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>rocketlogger.data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for rocketlogger.data</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RocketLogger Data Import Support.</span>

<span class="sd">File reading support for RocketLogger data (rld) files.</span>

<span class="sd">Copyright (c) 2016-2017, Swiss Federal Institute of Technology (ETH Zurich)</span>
<span class="sd">All rights reserved.</span>

<span class="sd">Redistribution and use in source and binary forms, with or without</span>
<span class="sd">modification, are permitted provided that the following conditions are met:</span>

<span class="sd">* Redistributions of source code must retain the above copyright notice, this</span>
<span class="sd">  list of conditions and the following disclaimer.</span>

<span class="sd">* Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="sd">  this list of conditions and the following disclaimer in the documentation</span>
<span class="sd">  and/or other materials provided with the distribution.</span>

<span class="sd">* Neither the name of the copyright holder nor the names of its</span>
<span class="sd">  contributors may be used to endorse or promote products derived from</span>
<span class="sd">  this software without specific prior written permission.</span>

<span class="sd">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<span class="sd">AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="sd">IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<span class="sd">DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE</span>
<span class="sd">FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<span class="sd">DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<span class="sd">SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<span class="sd">CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<span class="sd">OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="sd">OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span><span class="p">,</span> <span class="n">floor</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">splitext</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>


<span class="n">_ROCKETLOGGER_FILE_MAGIC</span> <span class="o">=</span> <span class="mh">0x444C5225</span>

<span class="n">_SUPPORTED_FILE_VERSIONS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">_BINARY_CHANNEL_STUFF_BYTES</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">_TIMESTAMP_SECONDS_BYTES</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">_TIMESTAMP_NANOSECONDS_BYTES</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">_TIMESTAMP_BYTES</span> <span class="o">=</span> <span class="n">_TIMESTAMP_SECONDS_BYTES</span> <span class="o">+</span> <span class="n">_TIMESTAMP_NANOSECONDS_BYTES</span>

<span class="n">_FILE_MAGIC_BYTES</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">_FILE_VERSION_BYTES</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">_HEADER_LENGHT_BYTES</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">_DATA_BLOCK_SIZE_BYTES</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">_DATA_BLOCK_COUNT_BYTES</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">_SAMPLE_COUNT_BYTES</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">_SAMPLE_RATE_BYTES</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">_MAC_ADDRESS_BYTES</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">_COMMENT_LENGTH_BYTES</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">_CHANNEL_BINARY_COUNT_BYTES</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">_CHANNEL_ANALOG_COUNT_BYTES</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">_CHANNEL_UNIT_INDEX_BYTES</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">_CHANNEL_SCALE_BYTES</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">_CHANNEL_DATA_BYTES_BYTES</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">_CHANNEL_VALID_LINK_BYTES</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">_CHANNEL_NAME_BYTES</span> <span class="o">=</span> <span class="mi">16</span>

<span class="n">_CHANNEL_UNIT_NAMES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;unitless&#39;</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;voltage&#39;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;current&#39;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;binary&#39;</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;range valid (binary)&#39;</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;illuminance&#39;</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;temerature&#39;</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="s1">&#39;percent&#39;</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="s1">&#39;preasure&#39;</span><span class="p">,</span>
    <span class="mh">0xffffffff</span><span class="p">:</span> <span class="s1">&#39;undefined&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">_CHANNEL_IS_BINARY</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="mh">0xffffffff</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">_CHANNEL_VALID_UNLINKED</span> <span class="o">=</span> <span class="mi">65535</span>

<span class="n">_CHANNEL_MERGE_CANDIDATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="s1">&#39;I1L&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="s1">&#39;I1H&#39;</span><span class="p">,</span> <span class="s1">&#39;merged&#39;</span><span class="p">:</span> <span class="s1">&#39;I1&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="s1">&#39;I2L&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="s1">&#39;I2H&#39;</span><span class="p">,</span> <span class="s1">&#39;merged&#39;</span><span class="p">:</span> <span class="s1">&#39;I2&#39;</span><span class="p">},</span>
<span class="p">]</span>


<span class="k">def</span> <span class="nf">_decimate_binary</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">decimation_factor</span><span class="p">,</span> <span class="n">threshold_value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decimate binary values, using a threshold value.</span>

<span class="sd">    :param values: Numpy vector of the values to decimate</span>

<span class="sd">    :param decimation_factor: The decimation factor</span>

<span class="sd">    :param threshold_value: The threshold value in [0, 1] to use for decimation</span>

<span class="sd">    :returns: Numpy vector of the decimated values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">count_new</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">decimation_factor</span><span class="p">)</span>
    <span class="n">count_old</span> <span class="o">=</span> <span class="n">count_new</span> <span class="o">*</span> <span class="n">decimation_factor</span>
    <span class="n">aggregated_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">count_old</span><span class="p">],</span>
                                   <span class="p">(</span><span class="n">count_new</span><span class="p">,</span> <span class="n">decimation_factor</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">aggregated_values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span>
                          <span class="p">(</span><span class="n">threshold_value</span> <span class="o">*</span> <span class="n">decimation_factor</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_decimate_min</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">decimation_factor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decimate binary values, forcing False if occuring.</span>

<span class="sd">    :param values: Numpy vector of the values to decimate</span>

<span class="sd">    :param decimation_factor: The decimation factor</span>

<span class="sd">    :returns: Numpy vector of the decimated values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">count_new</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">decimation_factor</span><span class="p">)</span>
    <span class="n">count_old</span> <span class="o">=</span> <span class="n">count_new</span> <span class="o">*</span> <span class="n">decimation_factor</span>
    <span class="n">aggregated_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">count_old</span><span class="p">],</span>
                                   <span class="p">(</span><span class="n">count_new</span><span class="p">,</span> <span class="n">decimation_factor</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">aggregated_values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">decimation_factor</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_decimate_max</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">decimation_factor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decimate binary values, forcing True if occuring.</span>

<span class="sd">    :param values: Numpy vector of the values to decimate</span>

<span class="sd">    :param decimation_factor: The decimation factor</span>

<span class="sd">    :returns: Numpy vector of the decimated values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">count_new</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">decimation_factor</span><span class="p">)</span>
    <span class="n">count_old</span> <span class="o">=</span> <span class="n">count_new</span> <span class="o">*</span> <span class="n">decimation_factor</span>
    <span class="n">aggregated_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">count_old</span><span class="p">],</span>
                                   <span class="p">(</span><span class="n">count_new</span><span class="p">,</span> <span class="n">decimation_factor</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">aggregated_values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_decimate_mean</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">decimation_factor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decimate analog values, using averaging of values.</span>

<span class="sd">    :param values: Numpy vector of the values to decimate</span>

<span class="sd">    :param decimation_factor: The decimation factor</span>

<span class="sd">    :returns: Numpy vector of the decimated values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">count_new</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">decimation_factor</span><span class="p">)</span>
    <span class="n">count_old</span> <span class="o">=</span> <span class="n">count_new</span> <span class="o">*</span> <span class="n">decimation_factor</span>
    <span class="n">aggregated_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">count_old</span><span class="p">],</span>
                                   <span class="p">(</span><span class="n">count_new</span><span class="p">,</span> <span class="n">decimation_factor</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">aggregated_values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_read_uint</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">data_size</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read an unsigned integer of defined data_size from file.</span>

<span class="sd">    :param file_handle: The file handle to read from at current position</span>

<span class="sd">    :param data_size: The data size in bytes of the integer to read</span>

<span class="sd">    :returns: The integer read and decoded</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">file_handle</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data_size</span><span class="p">),</span>
                          <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_read_int</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">data_size</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a signed integer of defined data_size from file.</span>

<span class="sd">    :param file_handle: The file handle to read from at current position</span>

<span class="sd">    :param data_size: The data size in bytes of the integer to read</span>

<span class="sd">    :returns: The integer read and decoded</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">file_handle</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data_size</span><span class="p">),</span>
                          <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_read_str</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read an ASCII string of defined length from file.</span>

<span class="sd">    :param file_handle: The file handle to read from at current position</span>

<span class="sd">    :param length: The length of the string to read</span>

<span class="sd">    :returns: The string read and decoded</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">raw_bytes</span> <span class="o">=</span> <span class="n">file_handle</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">raw_bytes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_read_timestamp</span><span class="p">(</span><span class="n">file_handle</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a timestamp from the file and convert to datetime object.</span>

<span class="sd">    :param file_handle: The file handle to read from at current position</span>

<span class="sd">    :returns: The read date and time as datetime object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">seconds</span> <span class="o">=</span> <span class="n">_read_int</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">_TIMESTAMP_SECONDS_BYTES</span><span class="p">)</span>
    <span class="n">nanoseconds</span> <span class="o">=</span> <span class="n">_read_int</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">_TIMESTAMP_NANOSECONDS_BYTES</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">seconds</span> <span class="o">+</span> <span class="mf">1e-9</span> <span class="o">*</span> <span class="n">nanoseconds</span><span class="p">,</span> <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_read_timestamp_datetime64</span><span class="p">(</span><span class="n">file_handle</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a timestamp from the file as nano second datetime64 (numpy)</span>

<span class="sd">    :param file_handle: The file handle to read from at current position</span>

<span class="sd">    :returns: The read date and time as datetime object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">seconds</span> <span class="o">=</span> <span class="n">_read_int</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">_TIMESTAMP_SECONDS_BYTES</span><span class="p">)</span>
    <span class="n">nanoseconds</span> <span class="o">=</span> <span class="n">_read_int</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">_TIMESTAMP_NANOSECONDS_BYTES</span><span class="p">)</span>
    <span class="n">timestamp_ns</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span> <span class="s1">&#39;ns&#39;</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="n">nanoseconds</span><span class="p">,</span> <span class="s1">&#39;ns&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">timestamp_ns</span>


<div class="viewcode-block" id="RocketLoggerFileError"><a class="viewcode-back" href="../../rocketlogger.html#rocketlogger.data.RocketLoggerFileError">[docs]</a><span class="k">class</span> <span class="nc">RocketLoggerFileError</span><span class="p">(</span><span class="ne">IOError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;RocketLogger file read/write related errors.&quot;&quot;&quot;</span>

    <span class="k">pass</span></div>


<div class="viewcode-block" id="RocketLoggerDataError"><a class="viewcode-back" href="../../rocketlogger.html#rocketlogger.data.RocketLoggerDataError">[docs]</a><span class="k">class</span> <span class="nc">RocketLoggerDataError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;RocketLogger data handling related errors.&quot;&quot;&quot;</span>

    <span class="k">pass</span></div>


<div class="viewcode-block" id="RocketLoggerDataWarning"><a class="viewcode-back" href="../../rocketlogger.html#rocketlogger.data.RocketLoggerDataWarning">[docs]</a><span class="k">class</span> <span class="nc">RocketLoggerDataWarning</span><span class="p">(</span><span class="ne">Warning</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;RocketLogger data handling related warnings.&quot;&quot;&quot;</span>

    <span class="k">pass</span></div>


<div class="viewcode-block" id="RocketLoggerData"><a class="viewcode-back" href="../../rocketlogger.html#rocketlogger.data.RocketLoggerData">[docs]</a><span class="k">class</span> <span class="nc">RocketLoggerData</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    RocketLogger data file handling class.</span>

<span class="sd">    File reading and basic data processing support for binary RocketLogger data</span>
<span class="sd">    files.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_filename</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_header</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_timestamps_monotonic</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_timestamps_realtime</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">join_files</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">decimation_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">memory_mapped</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor to create a RockerLoggerData object form data file.</span>

<span class="sd">        :param filename: The filename of the file to import</span>

<span class="sd">        :param join_files: Enalbe joining of multiple files if numbered files</span>
<span class="sd">            following the &quot;&lt;filename&gt;_p#.rld&quot; convention are found.</span>

<span class="sd">        :param decimation_factor: Decimation factor for values read</span>

<span class="sd">        :param memory_mapped: Set False to fall back to read entire file to</span>
<span class="sd">            memory at once, instead of using memory mapped reading. Might</span>
<span class="sd">            increase file read performance for many smaller files and/or</span>
<span class="sd">            some system configurations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;RocketLogger data file creation &#39;</span>
                                      <span class="s1">&#39;currently unsupported.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">join_files</span><span class="p">,</span> <span class="n">decimation_factor</span><span class="p">,</span>
                           <span class="n">memory_mapped</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FileNotFoundError</span><span class="p">(</span><span class="s1">&#39;File &quot;{}&quot; does not exist.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">filename</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_read_file_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_handle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a RocketLogger data file&#39;s header, including comment and channels.</span>

<span class="sd">        :param file_handle: The file handle to read from, with pointer</span>
<span class="sd">            positioned at file start</span>

<span class="sd">        :returns: Named struct containing the read file header data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;file_magic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_uint</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">_FILE_MAGIC_BYTES</span><span class="p">)</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;file_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_uint</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">_FILE_VERSION_BYTES</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;file_version&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_SUPPORTED_FILE_VERSIONS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RocketLoggerFileError</span><span class="p">(</span>
                <span class="s1">&#39;RocketLogger file version {} is not supported!&#39;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;file_version&#39;</span><span class="p">]))</span>

        <span class="c1"># file consistency check</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;file_magic&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">_ROCKETLOGGER_FILE_MAGIC</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RocketLoggerFileError</span><span class="p">(</span>
                <span class="s1">&#39;Invalid RocketLogger data file, file magic missmatch {:x}.&#39;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;file_magic&#39;</span><span class="p">]))</span>

        <span class="c1"># read static header fields</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;header_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_uint</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">_HEADER_LENGHT_BYTES</span><span class="p">)</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;data_block_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_uint</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span>
                                               <span class="n">_DATA_BLOCK_SIZE_BYTES</span><span class="p">)</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;data_block_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_uint</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span>
                                                <span class="n">_DATA_BLOCK_COUNT_BYTES</span><span class="p">)</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_uint</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">_SAMPLE_COUNT_BYTES</span><span class="p">)</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;sample_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_uint</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">_SAMPLE_RATE_BYTES</span><span class="p">)</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;mac_address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">file_handle</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">_MAC_ADDRESS_BYTES</span><span class="p">))</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_timestamp</span><span class="p">(</span><span class="n">file_handle</span><span class="p">)</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;comment_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_uint</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span>
                                              <span class="n">_COMMENT_LENGTH_BYTES</span><span class="p">)</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;channel_binary_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_uint</span><span class="p">(</span>
            <span class="n">file_handle</span><span class="p">,</span>
            <span class="n">_CHANNEL_BINARY_COUNT_BYTES</span><span class="p">)</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;channel_analog_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_uint</span><span class="p">(</span>
            <span class="n">file_handle</span><span class="p">,</span>
            <span class="n">_CHANNEL_ANALOG_COUNT_BYTES</span><span class="p">)</span>

        <span class="c1"># header consistency checks</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;comment_length&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;WARNING: Comment length unaligned {}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                  <span class="n">header</span><span class="p">[</span><span class="s1">&#39;comment_length&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;data_block_size&#39;</span><span class="p">])</span> <span class="o">!=</span>
                <span class="n">header</span><span class="p">[</span><span class="s1">&#39;data_block_count&#39;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">RocketLoggerFileError</span><span class="p">(</span><span class="s1">&#39;Inconsistency in number of samples &#39;</span>
                                        <span class="s1">&#39;taken!&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;data_block_size&#39;</span><span class="p">]</span> <span class="o">*</span>
                <span class="n">header</span><span class="p">[</span><span class="s1">&#39;data_block_count&#39;</span><span class="p">]):</span>
            <span class="n">old_count</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">]</span>
            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;data_block_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">]</span> <span class="o">/</span>
                                               <span class="n">header</span><span class="p">[</span><span class="s1">&#39;data_block_size&#39;</span><span class="p">])</span>
            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;data_block_count&#39;</span><span class="p">]</span> <span class="o">*</span>
                                      <span class="n">header</span><span class="p">[</span><span class="s1">&#39;data_block_size&#39;</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Skipping incomplete data block at end of file &#39;</span>
                  <span class="s1">&#39;({} samples)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">old_count</span> <span class="o">-</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">]))</span>

        <span class="c1"># read comment field</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_str</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;comment_length&#39;</span><span class="p">])</span>

        <span class="c1"># FILE VERSION DEPENDENT FIXES (BACKWARD COMPATIBILITY)</span>
        <span class="c1"># - none -</span>

        <span class="c1"># read channel headers</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;channel_binary_count&#39;</span><span class="p">]</span> <span class="o">+</span>
                        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;channel_analog_count&#39;</span><span class="p">]):</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">channel</span><span class="p">[</span><span class="s1">&#39;unit_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_uint</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span>
                                               <span class="n">_CHANNEL_UNIT_INDEX_BYTES</span><span class="p">)</span>
            <span class="n">channel</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_int</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">_CHANNEL_SCALE_BYTES</span><span class="p">)</span>
            <span class="n">channel</span><span class="p">[</span><span class="s1">&#39;data_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_uint</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span>
                                              <span class="n">_CHANNEL_DATA_BYTES_BYTES</span><span class="p">)</span>
            <span class="n">channel</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_uint</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span>
                                               <span class="n">_CHANNEL_VALID_LINK_BYTES</span><span class="p">)</span>
            <span class="n">channel</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_read_str</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">_CHANNEL_NAME_BYTES</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">channel</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_CHANNEL_UNIT_NAMES</span><span class="p">[</span><span class="n">channel</span><span class="p">[</span><span class="s1">&#39;unit_index&#39;</span><span class="p">]]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Undefined channel unit {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">channel</span><span class="p">[</span><span class="s1">&#39;unit_index&#39;</span><span class="p">]))</span>

            <span class="c1"># FILE VERSION DEPENDENT FIXES (BACKWARD COMPATIBILITY)</span>
            <span class="c1"># fix 1 based indexing of valid channel links for file version &lt;= 2</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;file_version&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">channel</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">_CHANNEL_VALID_UNLINKED</span><span class="p">)):</span>
                <span class="n">channel</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">channel</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="c1"># add channel to header</span>
            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">header</span>

    <span class="k">def</span> <span class="nf">_read_file_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_handle</span><span class="p">,</span> <span class="n">file_header</span><span class="p">,</span> <span class="n">decimation_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">memory_mapped</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read data block at the current position in the RocketLogger data file.</span>

<span class="sd">        :param file_handle: The file handle to read from, with pointer</span>
<span class="sd">            positioned at the begining of the block</span>

<span class="sd">        :param file_header: The file&#39;s header with the data alignment details.</span>

<span class="sd">        :param decimation_factor: Decimation factor for values read</span>

<span class="sd">        :param memory_mapped: Set False to fall back to read entire file to</span>
<span class="sd">            memory at once, instead of using memory mapped reading. Might</span>
<span class="sd">            increase file read performance for many smaller files and/or</span>
<span class="sd">            some system configurations.</span>

<span class="sd">        :returns: Tuple of realtime, monotonic clock based numpy datetime64</span>
<span class="sd">            arrays, and the list of numpy arrays containing the read channel</span>
<span class="sd">            data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># generate data type to read from header info</span>
        <span class="n">total_bin_bytes</span> <span class="o">=</span> <span class="n">_BINARY_CHANNEL_STUFF_BYTES</span> <span class="o">*</span> \
            <span class="n">ceil</span><span class="p">(</span><span class="n">file_header</span><span class="p">[</span><span class="s1">&#39;channel_binary_count&#39;</span><span class="p">]</span> <span class="o">/</span>
                 <span class="p">(</span><span class="n">_BINARY_CHANNEL_STUFF_BYTES</span> <span class="o">*</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">binary_channels_linked</span> <span class="o">=</span> <span class="p">[</span><span class="n">channel</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">]</span> <span class="k">for</span>
                                  <span class="n">channel</span> <span class="ow">in</span> <span class="n">file_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]]</span>
        <span class="n">analog_data_formats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">analog_data_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data_formats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data_names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">total_bin_bytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]</span>
            <span class="n">data_formats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;u{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_bin_bytes</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">file_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_CHANNEL_IS_BINARY</span><span class="p">[</span><span class="n">channel</span><span class="p">[</span><span class="s1">&#39;unit_index&#39;</span><span class="p">]]:</span>
                <span class="n">data_format</span> <span class="o">=</span> <span class="s1">&#39;&lt;i{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">[</span><span class="s1">&#39;data_size&#39;</span><span class="p">])</span>
                <span class="n">analog_data_formats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
                <span class="n">data_formats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
                <span class="n">analog_data_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                <span class="n">data_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

        <span class="c1"># read raw data from file</span>
        <span class="n">data_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">({</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">data_names</span><span class="p">,</span> <span class="s1">&#39;formats&#39;</span><span class="p">:</span> <span class="n">data_formats</span><span class="p">})</span>
        <span class="n">block_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;realtime_sec&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;M{}[s]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_TIMESTAMP_SECONDS_BYTES</span><span class="p">)),</span>
            <span class="p">(</span><span class="s1">&#39;realtime_ns&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;m{}[ns]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_TIMESTAMP_NANOSECONDS_BYTES</span><span class="p">)),</span>
            <span class="p">(</span><span class="s1">&#39;monotonic_sec&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;M{}[s]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_TIMESTAMP_SECONDS_BYTES</span><span class="p">)),</span>
            <span class="p">(</span><span class="s1">&#39;monotonic_ns&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;m{}[ns]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_TIMESTAMP_NANOSECONDS_BYTES</span><span class="p">)),</span>
            <span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">data_dtype</span><span class="p">,</span> <span class="n">file_header</span><span class="p">[</span><span class="s1">&#39;data_block_size&#39;</span><span class="p">]))])</span>

        <span class="c1"># access file data, either memory mapped or direct read to memory</span>
        <span class="k">if</span> <span class="n">memory_mapped</span><span class="p">:</span>
            <span class="n">file_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">memmap</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span>
                                  <span class="n">offset</span><span class="o">=</span><span class="n">file_header</span><span class="p">[</span><span class="s1">&#39;header_length&#39;</span><span class="p">],</span>
                                  <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                                  <span class="n">dtype</span><span class="o">=</span><span class="n">block_dtype</span><span class="p">,</span>
                                  <span class="n">shape</span><span class="o">=</span><span class="n">file_header</span><span class="p">[</span><span class="s1">&#39;data_block_count&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span>
                                    <span class="n">dtype</span><span class="o">=</span><span class="n">block_dtype</span><span class="p">,</span>
                                    <span class="n">count</span><span class="o">=</span><span class="n">file_header</span><span class="p">[</span><span class="s1">&#39;data_block_count&#39;</span><span class="p">],</span>
                                    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">file_data</span> <span class="o">=</span> <span class="n">file_data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

        <span class="c1"># reference for data blocks speeds up access time</span>
        <span class="n">block_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">file_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="n">copy</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="c1"># extract timestamps</span>
        <span class="n">timestamps_realtime</span> <span class="o">=</span> <span class="p">(</span><span class="n">file_data</span><span class="p">[</span><span class="s1">&#39;realtime_sec&#39;</span><span class="p">]</span> <span class="o">+</span>
                               <span class="n">file_data</span><span class="p">[</span><span class="s1">&#39;realtime_ns&#39;</span><span class="p">])</span>
        <span class="n">timestamps_monotonic</span> <span class="o">=</span> <span class="p">(</span><span class="n">file_data</span><span class="p">[</span><span class="s1">&#39;monotonic_sec&#39;</span><span class="p">]</span> <span class="o">+</span>
                                <span class="n">file_data</span><span class="p">[</span><span class="s1">&#39;monotonic_ns&#39;</span><span class="p">])</span>

        <span class="c1"># allocate empty list of channel data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">file_header</span><span class="p">[</span><span class="s1">&#39;channel_binary_count&#39;</span><span class="p">]</span> <span class="o">+</span>
                         <span class="n">file_header</span><span class="p">[</span><span class="s1">&#39;channel_analog_count&#39;</span><span class="p">])</span>

        <span class="c1"># extract binary channels</span>
        <span class="k">for</span> <span class="n">binary_channel_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">file_header</span><span class="p">[</span><span class="s1">&#39;channel_binary_count&#39;</span><span class="p">]):</span>
            <span class="n">channel_index</span> <span class="o">=</span> <span class="n">binary_channel_index</span>
            <span class="n">data</span><span class="p">[</span><span class="n">channel_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">binary_channel_index</span> <span class="o">&amp;</span>
                                           <span class="n">block_data</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">],</span>
                                           <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;b1&#39;</span><span class="p">))</span>
            <span class="n">data</span><span class="p">[</span><span class="n">channel_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">channel_index</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="n">file_header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">])</span>

            <span class="c1"># values decimation</span>
            <span class="k">if</span> <span class="n">decimation_factor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># decimate to zero for valid links, threshold otherwise</span>
                <span class="k">if</span> <span class="n">channel_index</span> <span class="ow">in</span> <span class="n">binary_channels_linked</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">channel_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">_decimate_min</span><span class="p">(</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">channel_index</span><span class="p">],</span> <span class="n">decimation_factor</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">channel_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">_decimate_binary</span><span class="p">(</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">channel_index</span><span class="p">],</span> <span class="n">decimation_factor</span><span class="p">)</span>

        <span class="c1"># extract analog channels</span>
        <span class="k">for</span> <span class="n">analog_channel_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">file_header</span><span class="p">[</span><span class="s1">&#39;channel_analog_count&#39;</span><span class="p">]):</span>
            <span class="n">channel_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">file_header</span><span class="p">[</span><span class="s1">&#39;channel_binary_count&#39;</span><span class="p">]</span> <span class="o">+</span>
                             <span class="n">analog_channel_index</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="n">channel_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">block_data</span><span class="p">[</span><span class="n">analog_data_names</span><span class="p">[</span><span class="n">analog_channel_index</span><span class="p">]],</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">analog_data_formats</span><span class="p">[</span><span class="n">analog_channel_index</span><span class="p">]))</span>
            <span class="n">data</span><span class="p">[</span><span class="n">channel_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">channel_index</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="n">file_header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">])</span>

            <span class="c1"># values decimation</span>
            <span class="k">if</span> <span class="n">decimation_factor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">channel_index</span><span class="p">]</span> <span class="o">=</span>\
                    <span class="n">_decimate_mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">channel_index</span><span class="p">],</span> <span class="n">decimation_factor</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">timestamps_realtime</span><span class="p">,</span> <span class="n">timestamps_monotonic</span><span class="p">,</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_get_channel_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the index of a data channel.</span>

<span class="sd">        :param channel_name: Name of the channel</span>

<span class="sd">        :returns: The index of the channel, None if not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">channel_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">channel</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">channel_index</span> <span class="o">=</span> <span class="n">channel_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">channel_index</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">channel_index</span>

    <span class="k">def</span> <span class="nf">_get_channel_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_indexes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the names of a list of channel indexes.</span>

<span class="sd">        :param channel_indexes: List or single index of channel(s)</span>

<span class="sd">        :returns: The channel name or a list multiple channel names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel_indexes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">channel_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_indexes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">channel_indexes</span><span class="p">:</span>
                    <span class="n">channel_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">channel_names</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span><span class="n">channel_indexes</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="RocketLoggerData.add_channel"><a class="viewcode-back" href="../../rocketlogger.html#rocketlogger.data.RocketLoggerData.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_info</span><span class="p">,</span> <span class="n">channel_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new data channel to the RocketLogger data structure.</span>

<span class="sd">        .. note::</span>

<span class="sd">            If a valid channel is linked to the channel being added, that</span>
<span class="sd">            channel has to be added first.</span>

<span class="sd">        :param channel_info: Channel info structure of the channel to add</span>

<span class="sd">        :param channel_data: The actual channel data to add, numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel_info</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Channel info structure is expected &#39;</span>
                                        <span class="s1">&#39;to be a dictionary.&#39;</span><span class="p">)</span>

        <span class="c1"># check full channel info available</span>
        <span class="k">if</span> <span class="s1">&#39;unit_index&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">channel_info</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Channel info: unit not defined.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;unit_index&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_CHANNEL_UNIT_NAMES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Channel info: invalid channel unit.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;scale&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">channel_info</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Channel info: scale not defined.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Channel info: invalid scale type.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;data_size&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">channel_info</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Channel info: data size not defined.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;data_size&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Channel info: invalid scale type.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;valid_link&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">channel_info</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Channel info: link not defined.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Channel info: invalid link type.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]))</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">_CHANNEL_VALID_UNLINKED</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Channel info: invalid link.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">channel_info</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Channel info: name undefined.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Channel info: invalid name type.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">_CHANNEL_NAME_BYTES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Channel info: name too long.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_channel_names</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Cannot add channel, another channel &#39;</span>
                                        <span class="s1">&#39;with name &quot;{}&quot; already exists.&#39;</span>
                                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>

        <span class="c1"># check data</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">channel_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Incompatible data size. &#39;</span>
                                            <span class="s1">&#39;Expected array of shape {}.&#39;</span>
                                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

        <span class="c1"># add channel info and data</span>
        <span class="k">if</span> <span class="n">_CHANNEL_IS_BINARY</span><span class="p">[</span><span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;unit_index&#39;</span><span class="p">]]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channel_binary_count&#39;</span><span class="p">],</span> <span class="n">channel_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channel_binary_count&#39;</span><span class="p">],</span> <span class="n">channel_info</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channel_binary_count&#39;</span><span class="p">]</span> <span class="o">=</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channel_binary_count&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel_info</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channel_analog_count&#39;</span><span class="p">]</span> <span class="o">=</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channel_analog_count&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="RocketLoggerData.remove_channel"><a class="viewcode-back" href="../../rocketlogger.html#rocketlogger.data.RocketLoggerData.remove_channel">[docs]</a>    <span class="k">def</span> <span class="nf">remove_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a data channel from the RocketLogger data structure.</span>

<span class="sd">        .. note::</span>

<span class="sd">            Linked valid channels are not automatically removed. If they shall</span>
<span class="sd">            be removed as well, call this function first on the linked channel.</span>

<span class="sd">        :param channel_name: Name of the channel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">channel_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channel_index</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">channel_index</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Channel &quot;{}&quot; not found.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>

        <span class="c1"># update links of channels affected by indexing change</span>
        <span class="k">for</span> <span class="n">channel_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">channel_index</span><span class="p">:</span>
                <span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_CHANNEL_VALID_UNLINKED</span>
            <span class="k">elif</span> <span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">channel_index</span><span class="p">:</span>
                <span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">channel_info</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># delete actual data and header entry</span>
        <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">channel_index</span><span class="p">])</span>
        <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span><span class="n">channel_index</span><span class="p">])</span>

        <span class="c1"># adjust header fields</span>
        <span class="k">if</span> <span class="n">channel_index</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channel_binary_count&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channel_binary_count&#39;</span><span class="p">]</span> <span class="o">=</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channel_binary_count&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channel_analog_count&#39;</span><span class="p">]</span> <span class="o">=</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channel_analog_count&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="RocketLoggerData.load_file"><a class="viewcode-back" href="../../rocketlogger.html#rocketlogger.data.RocketLoggerData.load_file">[docs]</a>    <span class="k">def</span> <span class="nf">load_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">join_files</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">decimation_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">memory_mapped</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a RocketLogger data file and return an RLD object.</span>

<span class="sd">        :param filename: The filename of the file to import. If numbered</span>
<span class="sd">            files following the &quot;&lt;filename&gt;_p#.rld&quot; convention are found, they</span>
<span class="sd">            can be joined during import using the `join_files` flag.</span>

<span class="sd">        :param join_files: Enalbe joining of multiple files if numbered files</span>
<span class="sd">            following the &quot;&lt;filename&gt;_p#.rld&quot; convention are found.</span>

<span class="sd">        :param decimation_factor: Decimation factor for values read</span>

<span class="sd">        :param memory_mapped: Set False to fall back to read entire file to</span>
<span class="sd">            memory at once, instead of using memory mapped reading. Might</span>
<span class="sd">            increase file read performance for many smaller files and/or</span>
<span class="sd">            some system configurations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;A data file is already loaded. Use &#39;</span>
                                        <span class="s1">&#39;separate instance for new file.&#39;</span><span class="p">)</span>

        <span class="n">file_basename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="n">file_number</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">isfile</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handle</span><span class="p">:</span>
                <span class="c1"># read file header</span>
                <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file_header</span><span class="p">(</span><span class="n">file_handle</span><span class="p">)</span>

                <span class="c1"># consistency check: file stream position matches header size</span>
                <span class="k">if</span> <span class="s1">&#39;header_length&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">RocketLoggerFileError</span><span class="p">(</span><span class="s1">&#39;Invalid file header read.&#39;</span><span class="p">)</span>

                <span class="n">stream_position</span> <span class="o">=</span> <span class="n">file_handle</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">stream_position</span> <span class="o">!=</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;header_length&#39;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="n">RocketLoggerFileError</span><span class="p">(</span>
                        <span class="s1">&#39;File position {} does not match header size {}&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stream_position</span><span class="p">,</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;header_length&#39;</span><span class="p">]))</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;data_block_size&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="n">decimation_factor</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span>
                        <span class="s1">&#39;Decimation factor needs to be divider of the buffer &#39;</span>
                        <span class="s1">&#39;size.&#39;</span><span class="p">)</span>

                <span class="c1"># multi-file header</span>
                <span class="k">if</span> <span class="n">file_number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">header</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">]</span> <span class="o">=</span>\
                        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;data_block_count&#39;</span><span class="p">]</span> <span class="o">=</span>\
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;data_block_count&#39;</span><span class="p">]</span> <span class="o">+</span>
                         <span class="n">header</span><span class="p">[</span><span class="s1">&#39;data_block_count&#39;</span><span class="p">])</span>

                <span class="c1"># channels: read actual sampled data</span>
                <span class="n">timestamps_realtime</span><span class="p">,</span> <span class="n">timestamps_monotonic</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">_read_file_data</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span>
                                         <span class="n">decimation_factor</span><span class="o">=</span><span class="n">decimation_factor</span><span class="p">,</span>
                                         <span class="n">memory_mapped</span><span class="o">=</span><span class="n">memory_mapped</span><span class="p">)</span>

                <span class="c1"># create on first file, append on following</span>
                <span class="k">if</span> <span class="n">file_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps_realtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timestamps_realtime</span><span class="p">,</span> <span class="n">timestamps_realtime</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps_monotonic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timestamps_monotonic</span><span class="p">,</span> <span class="n">timestamps_monotonic</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps_realtime</span> <span class="o">=</span> <span class="n">timestamps_realtime</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps_monotonic</span> <span class="o">=</span> <span class="n">timestamps_monotonic</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>

            <span class="n">file_number</span> <span class="o">=</span> <span class="n">file_number</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;{}_p{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_basename</span><span class="p">,</span> <span class="n">file_number</span><span class="p">,</span>
                                          <span class="n">file_extension</span><span class="p">)</span>

            <span class="c1"># skip looking for next file if joining not enabled</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">join_files</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># adjust header files for decimation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">decimation_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;data_block_size&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;data_block_size&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">decimation_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;sample_rate&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;sample_rate&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">decimation_factor</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Read {} file(s)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_number</span><span class="p">))</span></div>

<div class="viewcode-block" id="RocketLoggerData.get_channel_names"><a class="viewcode-back" href="../../rocketlogger.html#rocketlogger.data.RocketLoggerData.get_channel_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_channel_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the names of all the channels loaded from file.</span>

<span class="sd">        :returns: List of channel names sorted by name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">channel_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]:</span>
            <span class="n">channel_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">channel_names</span><span class="p">)</span></div>

<div class="viewcode-block" id="RocketLoggerData.get_comment"><a class="viewcode-back" href="../../rocketlogger.html#rocketlogger.data.RocketLoggerData.get_comment">[docs]</a>    <span class="k">def</span> <span class="nf">get_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the comment stored in the file header.</span>

<span class="sd">        :returns: Comment stored in the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="RocketLoggerData.get_data"><a class="viewcode-back" href="../../rocketlogger.html#rocketlogger.data.RocketLoggerData.get_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the data of the specified channels, by default of all channels.</span>

<span class="sd">        :param channel_names: The names of the channels for which the data</span>
<span class="sd">            shall be returned. List of channel names or &#39;all&#39; to select all</span>
<span class="sd">            channels.</span>

<span class="sd">        :returns: A numpy array containing the channel&#39;s data vectors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">channel_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">channel_names</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">channel_names</span><span class="p">:</span>
            <span class="n">channel_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_channel_names</span><span class="p">()</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_names</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">channel_name</span> <span class="ow">in</span> <span class="n">channel_names</span><span class="p">:</span>
            <span class="n">data_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channel_index</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data_index</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Channel &quot;{}&quot; not found.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
            <span class="n">values</span><span class="p">[:,</span> <span class="n">channel_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">data_index</span><span class="p">]</span> <span class="o">*</span>
                <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span><span class="n">data_index</span><span class="p">][</span><span class="s1">&#39;scale&#39;</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="RocketLoggerData.get_time"><a class="viewcode-back" href="../../rocketlogger.html#rocketlogger.data.RocketLoggerData.get_time">[docs]</a>    <span class="k">def</span> <span class="nf">get_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">absolute_time</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">time_reference</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the timestamp of the data.</span>

<span class="sd">        Using simple linear interpolation to generating the sample from the</span>
<span class="sd">        block timestamps.</span>

<span class="sd">        :param absolute_time: Wether the returned timestamps are relative to</span>
<span class="sd">            the start time in seconds (default) or absolute timestamps</span>

<span class="sd">        :param time_reference: Which clock data to get (for absolute time only,</span>
<span class="sd">            i.e. when `absolute_time=True`)</span>

<span class="sd">            - &#39;local&#39; The local oscillator clock (default)</span>
<span class="sd">            - &#39;network&#39; The network synchronized clock</span>

<span class="sd">        :returns: A numpy array containing the timestamps</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># transform value to absolute time if requested</span>
        <span class="k">if</span> <span class="n">absolute_time</span><span class="p">:</span>
            <span class="c1"># get requested timer data as numbers</span>
            <span class="k">if</span> <span class="n">time_reference</span> <span class="ow">is</span> <span class="s1">&#39;local&#39;</span><span class="p">:</span>
                <span class="n">block_timestamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps_monotonic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;&lt;i8&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">time_reference</span> <span class="ow">is</span> <span class="s1">&#39;network&#39;</span><span class="p">:</span>
                <span class="n">block_timestamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps_realtime</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;&lt;i8&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Time reference &quot;{}&quot; undefined.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                               <span class="n">time_reference</span><span class="p">))</span>

            <span class="c1"># interpolate</span>
            <span class="n">block_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;data_block_size&#39;</span><span class="p">])</span>
            <span class="n">data_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">])</span>

            <span class="n">data_timestamp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">data_points</span><span class="p">,</span> <span class="n">block_points</span><span class="p">,</span>
                                       <span class="n">block_timestamps</span><span class="p">)</span>

            <span class="c1"># convert to datetime again</span>
            <span class="n">timestamps</span> <span class="o">=</span> <span class="n">data_timestamp</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;&lt;M8[ns]&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">timestamps</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;sample_count&#39;</span><span class="p">])</span> <span class="o">/</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;sample_rate&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">timestamps</span></div>

<div class="viewcode-block" id="RocketLoggerData.merge_channels"><a class="viewcode-back" href="../../rocketlogger.html#rocketlogger.data.RocketLoggerData.merge_channels">[docs]</a>    <span class="k">def</span> <span class="nf">merge_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep_channels</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge seemlessly switched current channels into a combined channel.</span>

<span class="sd">        :param keep_channels: Whether the merged channels are kept</span>

<span class="sd">        :returns: Self reference to data object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">merged_channels</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">_CHANNEL_MERGE_CANDIDATES</span><span class="p">:</span>
            <span class="c1"># check if inputs available and linked</span>
            <span class="n">low_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channel_index</span><span class="p">(</span><span class="n">candidate</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">])</span>
            <span class="n">high_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channel_index</span><span class="p">(</span><span class="n">candidate</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">])</span>

            <span class="c1"># skip if one input unavailable</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">low_index</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">high_index</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># error if merge target exists</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channel_index</span><span class="p">(</span><span class="n">candidate</span><span class="p">[</span><span class="s1">&#39;merged&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Name of merged output channel &#39;</span>
                                            <span class="s1">&#39;&quot;{}&quot; already in use.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                                <span class="n">candidate</span><span class="p">[</span><span class="s1">&#39;merged&#39;</span><span class="p">]))</span>

            <span class="c1"># check for channel valid link</span>
            <span class="n">low_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span><span class="n">low_index</span><span class="p">]</span>
            <span class="n">high_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span><span class="n">high_index</span><span class="p">]</span>
            <span class="n">low_valid_index</span> <span class="o">=</span> <span class="n">low_channel</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">low_valid_index</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span>
                    <span class="s1">&#39;Channel &quot;{}&quot; has invalid link ({}).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">low_channel</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">low_valid_index</span><span class="p">))</span>

            <span class="c1"># build merged channel info and data</span>
            <span class="n">merged_channel_info</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">merged_channel_info</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">low_channel</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
            <span class="n">merged_channel_info</span><span class="p">[</span><span class="s1">&#39;unit_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">low_channel</span><span class="p">[</span><span class="s1">&#39;unit_index&#39;</span><span class="p">]</span>
            <span class="n">merged_channel_info</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">low_channel</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span>
            <span class="n">merged_channel_info</span><span class="p">[</span><span class="s1">&#39;data_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">low_channel</span><span class="p">[</span><span class="s1">&#39;data_size&#39;</span><span class="p">]</span> <span class="o">+</span>
                                                <span class="n">high_channel</span><span class="p">[</span><span class="s1">&#39;data_size&#39;</span><span class="p">])</span>
            <span class="n">merged_channel_info</span><span class="p">[</span><span class="s1">&#39;valid_link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_CHANNEL_VALID_UNLINKED</span>
            <span class="n">merged_channel_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">candidate</span><span class="p">[</span><span class="s1">&#39;merged&#39;</span><span class="p">]</span>

            <span class="n">merged_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">low_index</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span>
                <span class="s1">&#39;&lt;i{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">merged_channel_info</span><span class="p">[</span><span class="s1">&#39;data_size&#39;</span><span class="p">])))</span>
            <span class="n">merged_data</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">low_valid_index</span><span class="p">])</span> <span class="o">*</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">low_index</span><span class="p">]</span> <span class="o">+</span>
                           <span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">low_valid_index</span><span class="p">]))</span> <span class="o">*</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">high_index</span><span class="p">]</span> <span class="o">*</span>
                           <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">high_channel</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">low_channel</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]))</span>

            <span class="c1"># add merged channel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="n">merged_channel_info</span><span class="p">,</span> <span class="n">merged_data</span><span class="p">)</span>

            <span class="c1"># drop original channels if not kept, update header info</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_channels</span><span class="p">:</span>
                <span class="n">valid_channel_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channel_name</span><span class="p">(</span><span class="n">low_valid_index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_channel</span><span class="p">(</span><span class="n">valid_channel_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_channel</span><span class="p">(</span><span class="n">candidate</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_channel</span><span class="p">(</span><span class="n">candidate</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">])</span>

            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Merged channels &quot;{}&quot; and &quot;{}&quot; to &quot;{}&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">candidate</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">],</span> <span class="n">candidate</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">],</span> <span class="n">candidate</span><span class="p">[</span><span class="s1">&#39;merged&#39;</span><span class="p">]))</span>
            <span class="n">merged_channels</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">merged_channels</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No channels found to merge.&#39;</span><span class="p">,</span>
                          <span class="n">RocketLoggerDataWarning</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="RocketLoggerData.plot"><a class="viewcode-back" href="../../rocketlogger.html#rocketlogger.data.RocketLoggerData.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">],</span> <span class="n">show</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the loaded RocketLogger data.</span>

<span class="sd">        :param channel_names: The names of the channels for which the</span>
<span class="sd">            data shall be returned. List of channel names (or combination of):</span>

<span class="sd">            - &#39;all&#39; to select all channels,</span>
<span class="sd">            - &#39;voltages&#39; to select voltag channels,</span>
<span class="sd">            - &#39;currents&#39; to select current channels,</span>
<span class="sd">            - &#39;digital&#39; to select digital channels.</span>

<span class="sd">        :param show: Whether to show the plot window or not</span>

<span class="sd">        :returns: The matplotlib plot object used for plotting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">channel_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">channel_names</span><span class="p">]</span>

        <span class="n">channels_digital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span>
            <span class="s1">&#39;channel_binary_count&#39;</span><span class="p">]]</span>
        <span class="n">channels_current</span> <span class="o">=</span> <span class="p">[</span><span class="n">channel</span> <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">channel</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;current&#39;</span><span class="p">]</span>
        <span class="n">channels_voltage</span> <span class="o">=</span> <span class="p">[</span><span class="n">channel</span> <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">channel</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;voltage&#39;</span><span class="p">]</span>
        <span class="n">channels_others</span> <span class="o">=</span> <span class="p">[</span><span class="n">channel</span> <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span>
            <span class="s1">&#39;channels&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channel_binary_count&#39;</span><span class="p">]:]</span>
            <span class="k">if</span> <span class="n">channel</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;voltage&#39;</span><span class="p">,</span> <span class="s1">&#39;current&#39;</span><span class="p">]]</span>

        <span class="n">plot_current_channels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">plot_digital_channels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">plot_voltage_channels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">plot_other_channels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># get and group channels to plot</span>
        <span class="k">for</span> <span class="n">channel_name</span> <span class="ow">in</span> <span class="n">channel_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">channel_name</span> <span class="ow">is</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">plot_current_channels</span> <span class="o">=</span> <span class="n">channels_current</span>
                <span class="n">plot_digital_channels</span> <span class="o">=</span> <span class="n">channels_digital</span>
                <span class="n">plot_voltage_channels</span> <span class="o">=</span> <span class="n">channels_voltage</span>
                <span class="n">plot_other_channels</span> <span class="o">=</span> <span class="n">channels_others</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">channel_name</span> <span class="ow">is</span> <span class="s1">&#39;voltages&#39;</span><span class="p">:</span>
                <span class="n">plot_voltage_channels</span> <span class="o">=</span> <span class="n">channels_voltage</span>
            <span class="k">elif</span> <span class="n">channel_name</span> <span class="ow">is</span> <span class="s1">&#39;currents&#39;</span><span class="p">:</span>
                <span class="n">plot_current_channels</span> <span class="o">=</span> <span class="n">channels_current</span>
            <span class="k">elif</span> <span class="n">channel_name</span> <span class="ow">is</span> <span class="s1">&#39;digital&#39;</span><span class="p">:</span>
                <span class="n">plot_digital_channels</span> <span class="o">=</span> <span class="n">channels_digital</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">channel_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_channel_index</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">channel_index</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">RocketLoggerDataError</span><span class="p">(</span><span class="s1">&#39;Channel {} not found&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">channel_name</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">channel_name</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channels_voltage</span><span class="p">]:</span>
                    <span class="n">plot_voltage_channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span>
                        <span class="n">channel_index</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">channel_name</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channels_current</span><span class="p">]:</span>
                    <span class="n">plot_current_channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span>
                        <span class="n">channel_index</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">channel_name</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channels_digital</span><span class="p">]:</span>
                    <span class="n">plot_digital_channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span>
                        <span class="n">channel_index</span><span class="p">])</span>

        <span class="c1"># prepare plot groups</span>
        <span class="n">plot_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">plot_voltage_channels</span><span class="p">,</span> <span class="n">plot_current_channels</span><span class="p">,</span>
                       <span class="n">plot_digital_channels</span><span class="p">,</span> <span class="n">plot_other_channels</span><span class="p">]</span>
        <span class="n">plot_groups_axis_label</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;voltage [V]&#39;</span><span class="p">,</span> <span class="s1">&#39;current [A]&#39;</span><span class="p">,</span> <span class="s1">&#39;digital&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="n">plot_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>

        <span class="n">subplot_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">group</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">plot_groups</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_count</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subplot_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>

        <span class="c1"># plot</span>
        <span class="n">subplot_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plot_groups</span><span class="p">)):</span>
            <span class="n">plot_channels</span> <span class="o">=</span> <span class="n">plot_groups</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">plot_channels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">plot_channel_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">channel</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">plot_channels</span><span class="p">]</span>
            <span class="n">plot_channel_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">plot_channel_names</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">subplot_index</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_time</span><span class="p">,</span> <span class="n">plot_channel_data</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">subplot_index</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">plot_groups_axis_label</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">subplot_index</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">plot_channel_names</span><span class="p">)</span>
            <span class="n">subplot_index</span> <span class="o">=</span> <span class="n">subplot_index</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">ax</span><span class="p">[</span><span class="n">subplot_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [s]&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">plt</span></div></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Computer Engineering Group, ETH Zurich.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.1a1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>